import { useState } from "react";
import Navbar from "@/components/Navbar";
import Footer from "@/components/Footer";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Card, CardContent } from "@/components/ui/card";
import { trpc } from "@/lib/trpc";
import { toast } from "sonner";
import { useLocation } from "wouter";
import { useTranslation } from "react-i18next";
import SEOHead from "@/components/seo/SEOHead";

export default function PartnerProgram() {
  const { t } = useTranslation();
  const [currentStep, setCurrentStep] = useState(1);
  const [, setLocation] = useLocation();

  // Form data
  const [partnerType, setPartnerType] = useState("");
  const [companyName, setCompanyName] = useState("");
  const [businessNumber, setBusinessNumber] = useState("");
  const [contactName, setContactName] = useState("");
  const [contactEmail, setContactEmail] = useState("");
  const [contactPhone, setContactPhone] = useState("");
  const [address, setAddress] = useState("");
  const [companySize, setCompanySize] = useState("");
  const [annualRevenue, setAnnualRevenue] = useState("");
  const [mainBusiness, setMainBusiness] = useState("");
  const [cooperationIntent, setCooperationIntent] = useState("");

  const addPartnerMutation = trpc.admin.partners.add.useMutation({
    onSuccess: () => {
      toast.success("ç”³è«‹å·²æäº¤ï¼æˆ‘å€‘å°‡ç›¡å¿«èˆ‡æ‚¨è¯ç¹«ã€‚");
      setCurrentStep(4);
    },
    onError: (error) => {
      toast.error("æäº¤å¤±æ•—ï¼š" + error.message);
    },
  });

  const handleNextStep = () => {
    if (currentStep === 1 && !partnerType) {
      toast.error("è«‹é¸æ“‡åˆä½œé¡å‹");
      return;
    }
    if (currentStep === 2) {
      if (!companyName || !contactName || !contactEmail || !contactPhone) {
        toast.error("è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½");
        return;
      }
    }
    if (currentStep === 3) {
      // Submit form
      addPartnerMutation.mutate({
        partnerType,
        companyName,
        businessNumber,
        contactName,
        contactEmail,
        contactPhone,
        address,
        companySize,
        annualRevenue,
        mainBusiness,
        cooperationIntent,
      });
      return;
    }
    setCurrentStep(currentStep + 1);
  };

  const handlePrevStep = () => {
    setCurrentStep(currentStep - 1);
  };

  const partnerTypes = [
    {
      id: "distributor",
      title: "ç¶“éŠ·å•†åˆä½œ",
      description: "ç”¢å“éŠ·å”®ä»£ç†",
    },
    {
      id: "retail",
      title: "é›¶å”®åˆä½œ",
      description: "å¯¦é«”åº—é¢éŠ·å”®",
    },
    {
      id: "enterprise",
      title: "ä¼æ¥­åˆä½œ",
      description: "ä¼æ¥­æ‰¹é‡æ¡è³¼",
    },
    {
      id: "technology",
      title: "æŠ€è¡“åˆä½œ",
      description: "æŠ€è¡“æˆæ¬Šèˆ‡åˆä½œ",
    },
  ];

  return (
    <div className="min-h-screen flex flex-col bg-white">
      <Navbar />

      {/* Hero Section */}
      <section className="bg-[#1a1d29] text-white py-24 px-6">
        <div className="container mx-auto max-w-6xl">
          <h1 className="text-5xl md:text-6xl font-bold mb-6">åˆä½œå¤¥ä¼´è¨ˆç•«</h1>
          <p className="text-2xl md:text-3xl mb-6 text-gray-300">é–‹æ”¾ã€åˆä½œã€å…±è´</p>
          <p className="text-lg md:text-xl text-gray-400 max-w-3xl">
            Apolnus è‡´åŠ›æ–¼ç‚ºå…¨çƒç”¨æˆ¶æä¾›é«˜å“è³ªçš„ç©ºæ°£æ¸…æ·¨è§£æ±ºæ–¹æ¡ˆã€‚æˆ‘å€‘ä¸»å¼µåˆä½œå…±è´ï¼Œé¡˜æ„åŒä¾†è‡ªä¸–ç•Œå„åœ°çš„åˆä½œå¤¥ä¼´æ”œæ‰‹ä¸¦é€²ï¼Œå…±å‰µæœªä¾†ã€‚
          </p>
        </div>
      </section>

      {/* Application Process */}
      <section className="py-20 px-6 bg-white">
        <div className="container mx-auto max-w-6xl">
          <h2 className="text-4xl font-bold text-center mb-16 text-gray-900">ç”³è«‹æµç¨‹</h2>
          {/* Desktop Version: Horizontal Layout */}
          <div className="hidden md:grid md:grid-cols-5 gap-8">
            {[
              { icon: "ğŸ“", title: "ä¿¡æ¯è¨»å†Š", desc: "æäº¤è¨»å†Šç”³è«‹", color: "border-green-500" },
              { icon: "ğŸ”", title: "è³‡è³ªå¯©æ ¸", desc: "å¯©æ ¸è¨»å†Šä¿¡æ¯", color: "border-blue-500" },
              { icon: "ğŸ¤", title: "æ½›åœ¨åˆä½œå¤¥ä¼´", desc: "é€šéå¯©æ ¸å¾Œï¼Œå³æˆç‚ºæ½›åœ¨åˆä½œå¤¥ä¼´ï¼ŒApolnuså°‡é€šéé›»è©±/éƒµä»¶çš„æ–¹å¼åšé€²ä¸€æ­¥æºé€š", color: "border-orange-500" },
              { icon: "ğŸ“„", title: "åˆåŒå¯©æ ¸åŠç°½ç½²", desc: "ç¶“éæºé€šé”æˆåˆä½œæ„å‘å¾Œï¼Œå”å•†åˆåŒå…§å®¹ä¸¦ç°½ç½²åˆåŒ", color: "border-purple-500" },
              { icon: "âœ…", title: "æ­£å¼æˆç‚ºåˆä½œå¤¥ä¼´", desc: "æ­£å¼æˆç‚ºåˆä½œå¤¥ä¼´å¾Œï¼Œå°‡å®‰æ’å°ˆäººå°æ¥å…·é«”åˆä½œäº‹å®œ", color: "border-cyan-500" },
            ].map((step, index) => (
              <div key={index} className="text-center">
                <div className="w-20 h-20 mx-auto mb-4 bg-blue-50 rounded-full flex items-center justify-center text-4xl">
                  {step.icon}
                </div>
                <h3 className="text-lg font-semibold mb-2 text-gray-900">{step.title}</h3>
                <p className="text-sm text-gray-600">{step.desc}</p>
              </div>
            ))}
          </div>
          {/* Mobile Version: Vertical Layout with Cards */}
          <div className="md:hidden space-y-6">
            {[
              { icon: "ğŸ“", title: "ä¿¡æ¯è¨»å†Š", desc: "æäº¤è¨»å†Šç”³è«‹", color: "border-green-500", number: "1" },
              { icon: "ğŸ”", title: "è³‡è³ªå¯©æ ¸", desc: "å¯©æ ¸è¨»å†Šä¿¡æ¯", color: "border-blue-500", number: "2" },
              { icon: "ğŸ¤", title: "æ½›åœ¨åˆä½œå¤¥ä¼´", desc: "é€šéå¯©æ ¸å¾Œï¼Œå³æˆç‚ºæ½›åœ¨åˆä½œå¤¥ä¼´ï¼ŒApolnuså°‡é€šéé›»è©±/éƒµä»¶çš„æ–¹å¼åšé€²ä¸€æ­¥æºé€š", color: "border-orange-500", number: "3" },
              { icon: "ğŸ“„", title: "åˆåŒå¯©æ ¸åŠç°½ç½²", desc: "ç¶“éæºé€šé”æˆåˆä½œæ„å‘å¾Œï¼Œå”å•†åˆåŒå…§å®¹ä¸¦ç°½ç½²åˆåŒ", color: "border-purple-500", number: "4" },
              { icon: "âœ…", title: "æ­£å¼æˆç‚ºåˆä½œå¤¥ä¼´", desc: "æ­£å¼æˆç‚ºåˆä½œå¤¥ä¼´å¾Œï¼Œå°‡å®‰æ’å°ˆäººå°æ¥å…·é«”åˆä½œäº‹å®œ", color: "border-cyan-500", number: "5" },
            ].map((step, index) => (
              <div key={index}>
                <Card className={`border-2 ${step.color} relative overflow-hidden`}>
                  <div className={`absolute top-2 right-2 w-8 h-8 ${step.color.replace('border', 'bg')} text-white rounded-full flex items-center justify-center text-sm font-bold`}>
                    {step.number}
                  </div>
                  <CardContent className="p-6">
                    <div className="flex items-start gap-4">
                      <div className="w-16 h-16 flex-shrink-0 bg-blue-50 rounded-full flex items-center justify-center text-3xl">
                        {step.icon}
                      </div>
                      <div className="flex-1">
                        <h3 className="text-xl font-semibold mb-2 text-gray-900">{step.title}</h3>
                        <p className="text-sm text-gray-600 leading-relaxed">{step.desc}</p>
                      </div>
                    </div>
                  </CardContent>
                </Card>
                {index < 4 && (
                  <div className="flex justify-center py-2">
                    <div className="w-0.5 h-8 bg-gray-300"></div>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* Application Form */}
      <section className="py-20 px-6 bg-gray-50">
        <div className="container mx-auto max-w-4xl">
          <Card className="shadow-lg">
            <CardContent className="p-8">
              {/* Step Indicator */}
              <div className="flex items-center justify-center mb-12">
                {[1, 2, 3, 4].map((step, index) => (
                  <div key={step} className="flex items-center">
                    <div
                      className={`w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg ${
                        currentStep === step
                          ? "bg-blue-600 text-white"
                          : currentStep > step
                          ? "bg-green-500 text-white"
                          : "bg-gray-300 text-gray-600"
                      }`}
                    >
                      {step}
                    </div>
                    {index < 3 && (
                      <div
                        className={`w-16 h-1 ${
                          currentStep > step ? "bg-green-500" : "bg-gray-300"
                        }`}
                      />
                    )}
                  </div>
                ))}
              </div>

              {/* Step Labels */}
              <div className="flex justify-center mb-12 text-sm text-gray-600">
                <div className="flex gap-16">
                  <span className={currentStep === 1 ? "font-bold text-blue-600" : ""}>
                    é¸æ“‡åˆä½œé¡å‹
                  </span>
                  <span className={currentStep === 2 ? "font-bold text-blue-600" : ""}>
                    ä¼æ¥­åŸºæœ¬ä¿¡æ¯
                  </span>
                  <span className={currentStep === 3 ? "font-bold text-blue-600" : ""}>
                    å•†æ¥­èƒŒæ™¯ä¿¡æ¯
                  </span>
                  <span className={currentStep === 4 ? "font-bold text-blue-600" : ""}>
                    å®Œæˆç™»è¨˜
                  </span>
                </div>
              </div>

              {/* Step 1: Partner Type Selection */}
              {currentStep === 1 && (
                <div>
                  <h3 className="text-2xl font-bold mb-8 text-gray-900">è«‹é¸æ“‡åˆä½œé¡å‹</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {partnerTypes.map((type) => (
                      <Card
                        key={type.id}
                        className={`cursor-pointer transition-all hover:shadow-lg ${
                          partnerType === type.id ? "border-2 border-blue-600 bg-blue-50" : ""
                        }`}
                        onClick={() => setPartnerType(type.id)}
                      >
                        <CardContent className="p-6">
                          <h4 className="text-xl font-bold mb-2 text-gray-900">{type.title}</h4>
                          <p className="text-gray-600">{type.description}</p>
                        </CardContent>
                      </Card>
                    ))}
                  </div>
                </div>
              )}

              {/* Step 2: Company Basic Information */}
              {currentStep === 2 && (
                <div>
                  <h3 className="text-2xl font-bold mb-8 text-gray-900">ä¼æ¥­åŸºæœ¬ä¿¡æ¯</h3>
                  <div className="space-y-6">
                    <div>
                      <Label htmlFor="companyName" className="text-base">
                        å…¬å¸åç¨± <span className="text-red-500">*</span>
                      </Label>
                      <Input
                        id="companyName"
                        value={companyName}
                        onChange={(e) => setCompanyName(e.target.value)}
                        placeholder="è«‹è¼¸å…¥å…¬å¸åç¨±"
                        className="mt-2"
                      />
                    </div>
                    <div>
                      <Label htmlFor="businessNumber" className="text-base">
                        çµ±ä¸€ç·¨è™Ÿ
                      </Label>
                      <Input
                        id="businessNumber"
                        value={businessNumber}
                        onChange={(e) => setBusinessNumber(e.target.value)}
                        placeholder="è«‹è¼¸å…¥çµ±ä¸€ç·¨è™Ÿ"
                        className="mt-2"
                      />
                    </div>
                    <div>
                      <Label htmlFor="contactName" className="text-base">
                        è¯çµ¡äººå§“å <span className="text-red-500">*</span>
                      </Label>
                      <Input
                        id="contactName"
                        value={contactName}
                        onChange={(e) => setContactName(e.target.value)}
                        placeholder="è«‹è¼¸å…¥è¯çµ¡äººå§“å"
                        className="mt-2"
                      />
                    </div>
                    <div>
                      <Label htmlFor="contactEmail" className="text-base">
                        é›»å­éƒµä»¶ <span className="text-red-500">*</span>
                      </Label>
                      <Input
                        id="contactEmail"
                        type="email"
                        value={contactEmail}
                        onChange={(e) => setContactEmail(e.target.value)}
                        placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶"
                        className="mt-2"
                      />
                    </div>
                    <div>
                      <Label htmlFor="contactPhone" className="text-base">
                        è¯çµ¡é›»è©± <span className="text-red-500">*</span>
                      </Label>
                      <Input
                        id="contactPhone"
                        value={contactPhone}
                        onChange={(e) => setContactPhone(e.target.value)}
                        placeholder="è«‹è¼¸å…¥è¯çµ¡é›»è©±"
                        className="mt-2"
                      />
                    </div>
                    <div>
                      <Label htmlFor="address" className="text-base">
                        å…¬å¸åœ°å€
                      </Label>
                      <Input
                        id="address"
                        value={address}
                        onChange={(e) => setAddress(e.target.value)}
                        placeholder="è«‹è¼¸å…¥å…¬å¸åœ°å€"
                        className="mt-2"
                      />
                    </div>
                  </div>
                </div>
              )}

              {/* Step 3: Business Background */}
              {currentStep === 3 && (
                <div>
                  <h3 className="text-2xl font-bold mb-8 text-gray-900">å•†æ¥­èƒŒæ™¯ä¿¡æ¯</h3>
                  <div className="space-y-6">
                    <div>
                      <Label htmlFor="companySize" className="text-base">
                        å…¬å¸è¦æ¨¡
                      </Label>
                      <Input
                        id="companySize"
                        value={companySize}
                        onChange={(e) => setCompanySize(e.target.value)}
                        placeholder="ä¾‹å¦‚ï¼š50-100äºº"
                        className="mt-2"
                      />
                    </div>
                    <div>
                      <Label htmlFor="annualRevenue" className="text-base">
                        å¹´ç‡Ÿæ¥­é¡
                      </Label>
                      <Input
                        id="annualRevenue"
                        value={annualRevenue}
                        onChange={(e) => setAnnualRevenue(e.target.value)}
                        placeholder="ä¾‹å¦‚ï¼š1000è¬-5000è¬"
                        className="mt-2"
                      />
                    </div>
                    <div>
                      <Label htmlFor="mainBusiness" className="text-base">
                        ä¸»è¦æ¥­å‹™
                      </Label>
                      <Textarea
                        id="mainBusiness"
                        value={mainBusiness}
                        onChange={(e) => setMainBusiness(e.target.value)}
                        placeholder="è«‹ç°¡è¿°æ‚¨çš„ä¸»è¦æ¥­å‹™ç¯„åœ"
                        className="mt-2"
                        rows={4}
                      />
                    </div>
                    <div>
                      <Label htmlFor="cooperationIntent" className="text-base">
                        åˆä½œæ„å‘
                      </Label>
                      <Textarea
                        id="cooperationIntent"
                        value={cooperationIntent}
                        onChange={(e) => setCooperationIntent(e.target.value)}
                        placeholder="è«‹èªªæ˜æ‚¨çš„åˆä½œæ„å‘å’ŒæœŸæœ›"
                        className="mt-2"
                        rows={4}
                      />
                    </div>
                  </div>
                </div>
              )}

              {/* Step 4: Completion */}
              {currentStep === 4 && (
                <div className="text-center py-12">
                  <div className="w-20 h-20 mx-auto mb-6 bg-green-100 rounded-full flex items-center justify-center text-5xl">
                    âœ…
                  </div>
                  <h3 className="text-3xl font-bold mb-4 text-gray-900">ç”³è«‹å·²æäº¤ï¼</h3>
                  <p className="text-lg text-gray-600 mb-8">
                    æ„Ÿè¬æ‚¨çš„ç”³è«‹ï¼Œæˆ‘å€‘å°‡åœ¨ 3-5 å€‹å·¥ä½œæ—¥å…§èˆ‡æ‚¨è¯ç¹«ã€‚
                  </p>
                  <Button onClick={() => setLocation("/")} size="lg">
                    è¿”å›é¦–é 
                  </Button>
                </div>
              )}

              {/* Navigation Buttons */}
              {currentStep < 4 && (
                <div className="flex justify-between mt-12">
                  {currentStep > 1 && (
                    <Button variant="outline" onClick={handlePrevStep} size="lg">
                      ä¸Šä¸€æ­¥
                    </Button>
                  )}
                  <Button
                    onClick={handleNextStep}
                    size="lg"
                    className="ml-auto"
                    disabled={addPartnerMutation.isPending}
                  >
                    {currentStep === 3
                      ? addPartnerMutation.isPending
                        ? "æäº¤ä¸­..."
                        : "æäº¤ç”³è«‹"
                      : "ä¸‹ä¸€æ­¥"}
                  </Button>
                </div>
              )}
            </CardContent>
          </Card>
        </div>
      </section>

      <Footer />
    </div>
  );
}
